<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œë¬¼ ëª©ë¡</title>
    <link rel="stylesheet" href="/css/community/boardList.css">
    <link rel="stylesheet" href="/css/main/header.css">
    <link rel="stylesheet" href="/css/main/navBar.css">
</head>
<body>
<main th:insert="~{/main/header.html :: header}"></main>
<div class="navBarBody">
    <main th:insert="~{/main/navBar.html :: navBar}"></main>
    <div class="list_group">
        <div>
            <div>
                <select id="nameSelect" onchange="redirectToSelectedPage()">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="/board/hyeeun/paging">í˜œì€</option>
                    <option value="/board/seoyun/boardList">ì„œìœ¤</option>
                    <option value="/board/yoonseo/paging">ìœ¤ì„œ</option>
                    <option value="/board/yuna/paging">ìœ¤ì•„</option>
                </select>
            </div>
            <div class="list_count">
                <span>ì „ì²´ê¸€</span>
                <span>10</span>
                <span>/</span>
                <span id="totalPosts" th:text="${totalCount}"></span>
            </div>
            <div class="list_boardGroup" th:each="board : ${boardList}">
                <div class="list_profileImg">
                    <img th:src="@{/img/ì‚¬ëŒ5.png}" alt="">
                </div>
                <div class="list_titleGroup">
                    <a th:href="@{|/board/seoyun/${board.id}|}" th:text="${board.boardTitle}"></a>
                </div>
                <div class="list_like">
                    <span class="likeButton" th:data-postid="${board.id}" onclick="likePost(this)">ğŸ¤</span>
                </div>
            </div>
        </div>
        <div class="pagingGroup">
            <!-- ì²«ë²ˆì§¸ í˜ì´ì§€ë¡œ ì´ë™ -->
            <!-- /board/paging?page=1 -->
            <a th:href="@{/board/seoyun/boardList(page=1)}"><<</a>
            <!-- ì´ì „ ë§í¬ í™œì„±í™” ë¹„í™œì„±í™” -->
            <!-- boardList.getNumber() ì‚¬ìš©ì:2í˜ì´ì§€ getNumber()=1 -->
            <a th:href="${boardList.first} ? '#' : @{/board/seoyun/boardList(page=${boardList.number})}"><</a>

            <!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬(í˜„ì¬ í˜ì´ì§€ëŠ” ìˆ«ìë§Œ)
                for(int page=startPage; page<=endPage; page++)-->
            <span th:each="page: ${#numbers.sequence(startPage, endPage)}">
                <!-- í˜„ì¬í˜ì´ì§€ëŠ” ë§í¬ ì—†ì´ ìˆ«ìë§Œ -->
                <span th:if="${page == boardList.number + 1}" th:text="${page}"></span>
                <!-- í˜„ì¬í˜ì´ì§€ ë²ˆí˜¸ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í˜ì´ì§€ë²ˆí˜¸ì—ëŠ” ë§í¬ë¥¼ ë³´ì—¬ì¤Œ -->
                <span th:unless="${page == boardList.number + 1}">
                    <a th:href="@{/board/seoyun/boardList(page=${page})}" th:text="${page}"></a>
                </span>
            </span>
            <!-- ë‹¤ìŒ ë§í¬ í™œì„±í™” ë¹„í™œì„±í™”
                ì‚¬ìš©ì: 2í˜ì´ì§€, getNumber: 1, 3í˜ì´ì§€-->
            <a th:href="${boardList.last} ? '#' : @{/board/seoyun/boardList(page=${boardList.number + 2})}">></a>
            <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™ -->
            <a th:href="@{/board/seoyun/boardList(page=${boardList.totalPages})}">>></a>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
    // AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ì—”ë“œ API í˜¸ì¶œ
    fetch('/board/seoyun/listCount')
        .then(response => response.json())
        .then(data => {
            // ì „ì²´ ê²Œì‹œë¬¼ ê°œìˆ˜ë¥¼ ê°€ì ¸ì™€ì„œ í‘œì‹œ
            document.getElementById('totalPosts').textContent = data.totalCount;
        })
        .catch(error => console.error('Error:', error));


    // ì„ íƒëœ ì˜µì…˜ì— ëŒ€í•œ í˜ì´ì§€ë¡œ ì´ë™
    function redirectToSelectedPage() {
        var selectBox = document.getElementById("nameSelect");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        if (selectedValue !== "") {
            window.location.href = selectedValue; // ì„ íƒëœ í˜ì´ì§€ë¡œ ì´ë™
        }
    }


    // ì¢‹ì•„ìš”ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    function likePost(element) {
        let postId = element.getAttribute("data-postid");
        postId = parseInt(postId);

        // ì¢‹ì•„ìš” ë²„íŠ¼ì˜ í˜„ì¬ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        const currentText = element.textContent.trim();
        // â¤ï¸ ë²„íŠ¼ì¼ ê²½ìš°
        if (currentText === 'â¤ï¸') {
            // ì¢‹ì•„ìš” ì·¨ì†Œ ìš”ì²­
            $.ajax({
                type: "POST",
                url : `/like/seoyun/${postId}/cancel`, // postId ë³€ìˆ˜ ì‚¬ìš©
                // data: { loggedInUser: loggedInUser },
                success: function (res) {
                    console.log("ì¢‹ì•„ìš” ì·¨ì†Œ ì„±ê³µ:", res);
                    // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ â™¡ë¡œ ë³€ê²½
                    element.textContent = 'ğŸ¤';
                },
                error  : function (err) {
                    console.error("ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨:", err);
                }
            });
        } else { // â™¡ ë²„íŠ¼ì¼ ê²½ìš°
            // ì¢‹ì•„ìš” ìš”ì²­
            $.ajax({
                type: "POST",
                url : `/like/seoyun/${postId}`, // postId ë³€ìˆ˜ ì‚¬ìš©
                // data: { loggedInUser: loggedInUser },
                success: function (res) {
                    console.log("ì¢‹ì•„ìš” ì„±ê³µ:", res);
                    // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ â¤ï¸ë¡œ ë³€ê²½
                    element.textContent = 'â¤ï¸';
                },
                error  : function (err) {
                    console.error("ì¢‹ì•„ìš” ì‹¤íŒ¨:", err);
                }
            });
        }
    }


    // ê²Œì‹œë¬¼ ëª©ë¡ì—ì„œ ì¢‹ì•„ìš” ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
    $(document).ready(function () {
        // ëª¨ë“  ê²Œì‹œë¬¼ì— ëŒ€í•´ ìˆœíšŒ
        $('.likeButton').each(function () {
            var postId = $(this).attr('data-postid'); // ê²Œì‹œë¬¼ ID ê°€ì ¸ì˜¤ê¸°
            var likeButton = $(this); // ì¢‹ì•„ìš” ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°

            // ì¢‹ì•„ìš” ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” AJAX ìš”ì²­
            $.ajax({
                type   : "GET",
                url    : `/like/seoyun/${postId}/isLiked`, // ê²Œì‹œë¬¼ì— ëŒ€í•œ ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸ API ì—”ë“œí¬ì¸íŠ¸
                success: function (isLiked) {
                    // ê°€ì ¸ì˜¨ ì¢‹ì•„ìš” ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì„¤ì •
                    if (isLiked) {
                        likeButton.text('â¤ï¸'); // ì´ë¯¸ ì¢‹ì•„ìš”í•œ ê²½ìš°
                    } else {
                        likeButton.text('ğŸ¤'); // ì¢‹ì•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°
                    }
                },
                error  : function (err) {
                    console.error("ì¢‹ì•„ìš” ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", err);
                }
            });
        });
    });

    $(document).ready(function () {
        $("#header").load("/../header.html", function () {
        });
        $("#navBar").load("/../navBar.html", function () {
        });
    })
</script>
</body>
</html>
